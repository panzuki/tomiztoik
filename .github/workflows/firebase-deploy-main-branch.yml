name: Firebase Hosting è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ (mainãƒ–ãƒ©ãƒ³ãƒ)

on:
  push:
    branches:
      - main # mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‚’ãƒˆãƒªã‚¬ãƒ¼

jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      NODE_ENV: production # ãƒ“ãƒ«ãƒ‰æ™‚ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

    steps:
      - name: ğŸš€ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ’» Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm' # npmã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦é«˜é€ŸåŒ–

      # package.jsonã® "build" ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒä¿®æ­£ã•ã‚ŒãŸãŸã‚ã€
      # npm ci ã¨ npm run build ã‚’å˜ä¸€ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè¡Œã§ãã¾ã™ã€‚ï¼ˆtainosignæ§‹é€ ï¼‰
      - name: ğŸ“¦ ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ“ãƒ«ãƒ‰
        run: |
          npm ci          # ãƒ«ãƒ¼ãƒˆã® package.json ã‚’åŸºã«ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          npm run build   # ä¿®æ­£ã•ã‚ŒãŸ "build" ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ (dist ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç”Ÿæˆ)

      - name: ğŸ“‚ ãƒ“ãƒ«ãƒ‰ç”Ÿæˆç‰©ï¼ˆdistï¼‰ã‚’ç¢ºèª
        # ãƒ«ãƒ¼ãƒˆã«ç”Ÿæˆã•ã‚ŒãŸ dist ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª
        run: ls -R dist 
        
      - name: ğŸ”¥ Firebase Hostingã¸ãƒ‡ãƒ—ãƒ­ã‚¤
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ãã®ã¾ã¾ä½¿ç”¨
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_TOMIZBASE }} 
          channelId: live
          projectId: tomizbase
          
          # ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ«ãƒ¼ãƒˆã«ç”Ÿæˆã•ã‚ŒãŸ 'dist' ã«æŒ‡å®š
          deploy_dir: dist

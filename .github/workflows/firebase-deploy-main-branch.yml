name: Firebase Hosting è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ (Vue 3/Tailwindå¯¾å¿œ)

on:
  push:
    branches:
      - main # mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‚’ãƒˆãƒªã‚¬ãƒ¼

jobs:
  deploy:
    # å®Ÿè¡Œç’°å¢ƒã‚’æŒ‡å®š
    runs-on: ubuntu-latest
    env:
      NODE_ENV: production # ãƒ“ãƒ«ãƒ‰æ™‚ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

    steps:
      - name: ğŸš€ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ’» Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm' 
          
      # ã‚¹ãƒ†ãƒƒãƒ— 1: ä¾å­˜é–¢ä¿‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      # ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ node_modules/.bin ã«å¿…è¦ãªãƒã‚¤ãƒŠãƒªãŒã™ã¹ã¦é…ç½®ã•ã‚Œã‚‹
      - name: ğŸ“¦ ä¾å­˜é–¢ä¿‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          rm -rf node_modules dist 
          npm ci

      # ã‚¹ãƒ†ãƒƒãƒ— 2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ (npm run ã‚³ãƒãƒ³ãƒ‰ã‚’å®Œå…¨ã«å›é¿)
      # run-pã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚¤ãƒŠãƒªã‚’ç›´æ¥å‘¼ã³å‡ºã™
      - name: ğŸ”¨ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ (ãƒã‚¤ãƒŠãƒªç›´æ¥å®Ÿè¡Œ)
        run: |
          # package.jsonã® "type-check" ã«ç›¸å½“
          ./node_modules/.bin/vue-tsc --build 
          # package.jsonã® "build-only" ã«ç›¸å½“
          ./node_modules/.bin/vite build 
        
      - name: ğŸ“‚ ãƒ“ãƒ«ãƒ‰ç”Ÿæˆç‰©ï¼ˆdistï¼‰ã‚’ç¢ºèª
        run: ls -R dist 
        
      - name: ğŸ”¥ Firebase Hostingã¸ãƒ‡ãƒ—ãƒ­ã‚¤
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_TOMIZBASE }} 
          channelId: live
          projectId: tomizbase
          entryPoint: .

name: Firebase Hosting è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ (Vue 3/Tailwindå¯¾å¿œ)

on:
  push:
    branches:
      - main # mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‚’ãƒˆãƒªã‚¬ãƒ¼

jobs:
  deploy:
    # å®Ÿè¡Œç’°å¢ƒã‚’æŒ‡å®š
    runs-on: ubuntu-latest
    env:
      NODE_ENV: production # ãƒ“ãƒ«ãƒ‰æ™‚ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

    steps:
      - name: ğŸš€ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ’» Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ“¦ ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ“ãƒ«ãƒ‰
        run: |
          rm -rf node_modules dist
          npm ci
          npm run build

      - name: ğŸ“‚ ãƒ“ãƒ«ãƒ‰ç”Ÿæˆç‰©ï¼ˆdistï¼‰ã‚’ç¢ºèª
        # ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ã€distãƒ•ã‚©ãƒ«ãƒ€ãŒç”Ÿæˆã•ã‚ŒãŸã‹ã‚’ç¢ºèª
        run: ls -R dist 
        
      - name: ğŸ”¥ Firebase Hostingã¸ãƒ‡ãƒ—ãƒ­ã‚¤
        # Firebase Extended ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          # Firebase ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ (GitHub Secretsã«ç™»éŒ²æ¸ˆã¿)
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_TOMIZBASE }} 
          # å¸¸ã« live ãƒãƒ£ãƒ³ãƒãƒ« (æœ¬ç•ªç’°å¢ƒ) ã«ãƒ‡ãƒ—ãƒ­ã‚¤
          channelId: live
          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ID ã‚’æŒ‡å®š
          projectId: tomizbase
          
          # ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œèµ·ç‚¹ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆ ( . ) ã«è¨­å®šã€‚
          # ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ãƒ«ãƒ¼ãƒˆã§ firebase.json ã‚’æ¢ã—ã€
          # ãã®ä¸­ã§æŒ‡å®šã•ã‚ŒãŸ "public": "dist" ã«å¾“ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
          entryPoint: .
